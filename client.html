<!DOCTYPE html>
<html>
<title>Authenticate PC</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<body>

<header class="w3-container w3-teal">
 <center> <h1>Authenticate This PC</h1></center>
</header>

<center>
<div class=" w3-green w3-animate-left " style="display: none; width: 30%;" id="SuccessMessage" >
<h3>Login was successful now you can close the window</h3>
</div>
<div style="margin-left:25%" class="w3-container w3-half w3-margin-top w3-center">

<form class="w3-container w3-card-4" >

<p>
<input class="w3-input" type="text" name='name' id="userName" style="width:90%" required>
<label>User Name</label></p>
<p>
<input class="w3-input" type="password" name='Pass_Code' id="passCode" style="width:90%" required>
<label>Pass_Code</label></p>
<label id="loginMessage" class="w3-red w3-animate-zoom"><b></b></label></p>



<p>
</form>
<button onclick="fetchIt()" class="w3-button w3-section w3-teal w3-ripple"> Log in </button></p>

<div id="modal" class="w3-modal">
     <div class="w3-modal-content w3-card-4 w3-animate-zoom"  style="max-width:600px">
         <span onclick=" document.getElementById('modal').style.display='none'"
      class="w3-button w3-display-topright">&times;</span>
      <form class="w3-container" action="/action_ge.php">
        <div class="w3-section">
          <label><b>Enter Admins Pass-Code</b></label>
          <input class="w3-input w3-border w3-margin-bottom" type="text" placeholder="Pass-Code" id="passCode1" name="Pass-Code" required>
          <center><label id="WrongPasscode" style="display: none;" class="w3-red"><b>Wrong Pass-code</b></label></center>
        </div>
      </form>
      <button onclick="fetchIt1()" class="w3-button w3-section w3-teal w3-ripple"> Continue </button></p>
    </div>
</div>
<div id="modal1" class="w3-modal">
     <div class="w3-modal-content w3-card-4 w3-animate-zoom"  style="max-width:600px">
         <span onclick=" document.getElementById('modal1').style.display='none'"
      class="w3-button w3-display-topright">&times;</span>
      <form class="w3-container" action="/action_ge.php">
        <div class="w3-section">
          <label><b>Enter New Computer-Id</b></label>
          <input class="w3-input w3-border w3-margin-bottom" type="text" placeholder="Computer_id" id='registerCode' name="registerCode" required>
          <center><label  id="isRegisteredSuccess" class="w3-green w3-animate-zoom" style="display: none;"><b>Pc registered</b></label></center>
          <center><label  id="isRegisteredFailure" class="w3-green w3-animate-zoom" style="display: none;"><b>Pc  already exist</b></label></center>
        </div>
      </form>
      <button onclick="fetchIt3()" class="w3-button w3-section w3-teal w3-ripple"> Register New Pc </button></p>
    </div>
</div>
<div id="modal3" class="w3-modal">
     <div class="w3-modal-content w3-card-4 w3-animate-zoom"  style="max-width:600px">
         <span onclick=" document.getElementById('modal3').style.display='none'"
      class="w3-button w3-display-topright">&times;</span>
      <form class="w3-container" action="/action_ge.php">
        <div class="w3-section">
          <center><h1>List</h1></center>
         </div>
      </form>
      <button onclick="fetchIt3()" class="w3-button w3-section w3-teal w3-ripple"> Register New Pc </button></p>
    </div>
</div>
</div>
<div></div>
</center>

</body>
<script>
 // console.log(PcNUMBER)
   async function postData(url = '', data = {}) {
  // Default options are marked with *
   console.log(data)
  const response = await fetch(url, {
    method: 'POST', 
    mode: 'cors',
    headers: {
      //'Content-Type': 'application/json'
       'Content-Type': 'application/x-www-form-urlencoded',
    },
   
     // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
    body:  new URLSearchParams({
      data: JSON.stringify(data) 
      })// body data type must match "Content-Type" header
  });
  return response.json(); // parses JSON response into native JavaScript objects
}

function fetchIt() {
  let userName=document.getElementById('userName').value
  let passCode=document.getElementById('passCode').value
  let d=new Date;
  let userDate=d.getDate()+" / "+d.getMonth()+1+" / "+d.getFullYear()
  let userTime= d.getHours()+" : "+d.getMinutes()
  let PCNumber=localStorage.getItem('PcNUMBER')
    postData('http://localhost:5000/userLoggin', { userName: userName,passCode:passCode,userDate:userDate,userTime:userTime,PCNumber:PCNumber })
  .then((data) => {
   // window.close()
   
   if(data.loginMessage){ 
    document.getElementById('loginMessage').style.display='block'
    document.getElementById('loginMessage').innerHTML=data.loginMessage
  }else{
  document.getElementById('SuccessMessage').style.display='block'
  setTimeout(()=>{
    window.close()
  },5000)
  }
  
  });
}
function fetchIt1() {
  let passCode=document.getElementById('passCode1').value
  

    postData('http://localhost:5000/AdminCodeCheck', { passCode: passCode})
  .then((data) => {
   if(data.isValid == true){ 
    open1()
    Close()
  }else{
  document.getElementById('WrongPasscode').style.display='block'
  }
  });
}
function fetchIt3() {
let registerCode=document.getElementById('registerCode').value
localStorage.setItem("PcNUMBER", registerCode);
let PcNUMBER = localStorage.getItem('PcNUMBER');
    postData('http://localhost:5000/RegisterPc', { registerCode: registerCode})
  .then((data) => {
   if(data.isRegistered == true){ 
    document.getElementById('isRegisteredSuccess').style.display='block'
  }else{
  document.getElementById('isRegisteredFailure').style.display='block'
  }
  });
}



    function open (){
        document.getElementById('modal').style.display='block'
    }
    function open3 (){
        document.getElementById('modal3').style.display='block'
    }
    function open1 (){
        document.getElementById('modal1').style.display='block'
    }
    function Close (){
        document.getElementById('modal').style.display='none'
    }
    function Close3 (){
        document.getElementById('modal3').style.display='none'
    }
    function Close1 (){
        document.getElementById('modal1').style.display='none'
    }
    if (document.addEventListener) {
  document.addEventListener('contextmenu', function(e) {
   open()
    e.preventDefault();
  }, false);
} else {
  document.attachEvent('oncontextmenu', function() {
   open()
    window.event.returnValue = false;
  });
}
console.log(localStorage.getItem('PcNUMBER'))
</script>
</html> 
